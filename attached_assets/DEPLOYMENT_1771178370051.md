# Deploying Katalyst Lexicon Extension via Google Workspace

This guide walks you through publishing the extension privately and force-installing it across your entire organization using the Google Admin Console.

---

## Overview

There are two phases:
1. **Publish** the extension to your organization's private Chrome Web Store
2. **Force-install** it via Google Workspace Admin Console so every team member gets it automatically

---

## Phase 1: Publish to Your Private Chrome Web Store

### Step 1: Enable Domain Publishing

1. Sign in to **admin.google.com** with your Super Admin account
2. Go to **Devices > Chrome > Apps & Extensions**
3. Select the **Users & browsers** tab at the top
4. Click **Additional settings** (gear icon, bottom-right area)
5. Find **Chrome Web Store permissions**
6. Enable **"Allow publishing domain-restricted private apps to the Chrome Web Store"**
7. Verify that **"Chrome Web Store private extensions"** is set to **"Allow private extensions"**
8. Click **Save**

> **Important:** Do this from the admin account (e.g., admin@katgroupinc.com), not a personal employee account. If that employee leaves and their account is deleted, the developer registration becomes invalid.

### Step 2: Register as a Chrome Web Store Developer

1. Go to **https://chrome.google.com/webstore/devconsole**
2. Sign in with your **@katgroupinc.com** admin account
3. Pay the one-time **$5 USD** registration fee (if not already registered)
4. Complete the developer profile

### Step 3: Package the Extension

1. On your computer, navigate to the `katalyst-lexicon-extension` folder
2. Select **all files and folders inside it** (manifest.json, background/, popup/, sidepanel/, options/, content/, shared/, assets/)
3. **Zip them** — make sure `manifest.json` is at the root of the zip, NOT nested in a subfolder

**Mac:**
```
cd katalyst-lexicon-extension
zip -r ../katalyst-lexicon-extension.zip . -x ".*" -x "__MACOSX/*"
```

**Windows:**
Select all files inside the folder → Right-click → Send to → Compressed (zipped) folder

### Step 4: Upload to Chrome Developer Dashboard

1. Go to **https://chrome.google.com/webstore/devconsole**
2. Click **"+ New item"** (blue button, top-right)
3. Upload the `.zip` file you just created
4. Wait for the upload to complete

### Step 5: Fill in Store Listing

1. **Title:** `Katalyst Lexicon`
2. **Summary:** `Search, browse, and propose terms for the Katalyst organizational glossary`
3. **Description:** (A paragraph about what the extension does for your team)
4. **Category:** `Productivity`
5. **Language:** English
6. **Icon:** Upload a 128x128 PNG icon
7. **Screenshots:** Take 1-2 screenshots of the popup and side panel in action (1280x800 or 640x400)

### Step 6: Set Visibility to Private (Your Domain Only)

1. Go to the **Distribution** tab
2. Under **Visibility**, select **"Private — [your domain]"**
   - This option only appears if Step 1 was completed correctly
   - It makes the extension visible ONLY to @katgroupinc.com accounts
3. Click **Save draft**

### Step 7: Submit for Review

1. Click **"Submit for review"**
2. Domain-private extensions typically get approved faster than public ones
3. After approval, it publishes automatically to your private Chrome Web Store
4. **Note your Extension ID** — it appears in the URL of your dashboard listing (a 32-character string like `abcdefghijklmnopqrstuvwxyzabcdef`)

---

## Phase 2: Force-Install via Google Admin Console

Once the extension is published, force-install it so every team member gets it automatically without having to find and install it themselves.

### Step 1: Open Admin Console

1. Go to **admin.google.com**
2. Sign in with your Super Admin account

### Step 2: Navigate to App Management

1. Go to **Devices > Chrome > Apps & extensions**
2. Click the **Users & browsers** tab at the top
3. On the left sidebar, select the **organizational unit** you want to target:
   - Select the **top-level org** to deploy to everyone
   - Or select a specific sub-org (e.g., "Engineering") to deploy to a subset first

### Step 3: Add the Extension

1. Hover over the **yellow (+) circle** in the bottom-right corner
2. Click **"Add Chrome app or extension by ID"**
3. Paste your **Extension ID** (from Step 7 of Phase 1)
4. Leave **"From the Chrome Web Store"** selected
5. Click **Save**

### Step 4: Set to Force Install

1. The extension panel opens on the right side
2. Under **Installation policy**, click the dropdown
3. Select **"Force install"**
   - This silently installs the extension on every managed Chrome browser
   - Users cannot uninstall it
   - Works even if the Chrome Web Store is disabled for users
4. Click **Save**

### Step 5: Pre-Configure the API URL (Optional but Recommended)

To save every user from having to manually enter the Replit API URL, you can set it via Chrome policy:

1. In the same extension panel (from Step 4), scroll down
2. Look for **"Policy for extensions"** (JSON text field)
3. Enter:
```json
{
  "apiBaseUrl": {
    "Value": "https://katalyst-lexicon.replit.app"
  }
}
```
4. Click **Save**

> **Note:** This requires adding managed storage support to the extension. For now, users can manually enter the URL in the extension's Settings page on first use. If you want the pre-config approach, let me know and I'll add the `storage.managed_schema` to the manifest.

### Step 6: Verify Deployment

**Test on one device first:**

1. Sign in to Chrome with a managed @katgroupinc.com account
2. Wait 1-2 minutes (or go to `chrome://policy` and click **"Reload policies"**)
3. Go to `chrome://extensions` — the Katalyst Lexicon extension should appear
4. It should show as **"Installed by your administrator"** and cannot be removed
5. Click the extension icon in the toolbar — the popup should appear
6. Click the gear icon → enter your Replit URL → Test Connection → Save

**Roll out to everyone:**

Once verified, apply the same policy to the top-level organizational unit to deploy org-wide.

---

## Timeline

| Step | Time |
|------|------|
| Enable domain publishing | 5 minutes |
| Register developer account | 5 minutes |
| Package and upload extension | 10 minutes |
| Fill in store listing | 15 minutes |
| Chrome Web Store review | 1-3 business days (private extensions are faster) |
| Force-install via Admin Console | 5 minutes |
| Policy propagation to all devices | 10-60 minutes |

**Total: ~40 minutes of work + 1-3 days for Chrome Web Store review**

---

## Updating the Extension

When you release a new version:

1. Bump the `version` in `manifest.json` (e.g., `1.0.0` → `1.0.1`)
2. Re-zip the extension folder
3. Go to the Chrome Developer Dashboard
4. Click your extension → **Package** tab → **Upload new package**
5. Submit for review
6. After approval, the update automatically deploys to all force-installed instances within a few hours

---

## Troubleshooting

| Issue | Solution |
|-------|----------|
| "Private" visibility option doesn't appear | Complete Phase 1, Step 1 (enable domain publishing) and make sure you're signed in with your domain account |
| Extension doesn't install on user devices | Check `chrome://policy` on the device — look for `ExtensionInstallForcelist`. If missing, the policy hasn't propagated yet |
| Users see "Cannot reach server" | They need to enter the correct Replit API URL in Settings. Or pre-configure it via Phase 2, Step 5 |
| Extension works but context menus don't appear | The user needs to restart Chrome after force-install for context menus to register |
