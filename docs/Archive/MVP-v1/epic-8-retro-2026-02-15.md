# Epic 8: Quality & Testing — Retrospective

Date: 2026-02-15
Facilitator: Bob (Scrum Master)
Epic: 8 — Quality & Testing
Status: Complete (4 stories done — all ACs met with documented gaps)

## Epic Summary

Epic 8 delivered the complete quality and accessibility layer for Katalyst Lexicon — adding dark mode with system preference detection and manual toggle, skip-to-content link and meaningful page titles for assistive technology, comprehensive Playwright E2E test suite covering 8 user journeys at 3 viewports, and a formal WCAG 2.1 AA compliance audit that found and fixed 48 accessibility issues across the entire application. This was the final epic in the project plan, designed to audit and polish all work from Epics 1-7.

The key architectural pattern — foundation-first ordering with Story 8.1 (dark mode) establishing the theme system before Stories 8.2 (accessibility), 8.3 (E2E tests), and 8.4 (audit) — enabled each subsequent story to build on established dark mode infrastructure.

## Story Completion Profile

| Story | Size | ACs | Files Created | Files Modified | Notes |
|-------|------|-----|---------------|----------------|-------|
| 8.1 Dark Mode & Theme System | M | 10 | 1 (use-theme.ts) | 6 | FOWT prevention, CSS transitions, brand token→semantic token migration |
| 8.2 Skip Link, Page Titles, Reduced Motion | S | 7 | 0 | 5 | Targeted animation selectors, inline useEffect pattern for titles |
| 8.3 Playwright E2E Test Suite | L | 11 | 9 (config + 8 spec files) | 2 | 8 user journeys, data-testid exclusive selectors |
| 8.4 WCAG 2.1 AA Compliance Audit | M | 8 | 2 (audit report + a11y test) | 15 | 48 issues found: 28 Critical + 15 Major + 5 CR — all fixed |

**Documented Gaps:**
- AC7: Multi-viewport axe-core testing (375px/768px/1280px) — automated tests run at default 1280px only
- Mobile Spotlight ARIA compliance not fully verified at mobile viewport
- `@playwright/test` in dependencies (should be devDependencies)
- Missing `test:e2e` npm script

## Git Commit Analysis

- Total commits: 27 (excluding saved-progress checkpoints)
- Fix/correction commits: 3 (~11% — low, but higher than Epic 7's 0%)
- Quality improvement commits: 13 (~48% — highest ever, reflecting quality epic nature)
- Most-touched source files:
  - `Layout.tsx` — 5 changes (skip link + ARIA + theme toggle)
  - `Settings.tsx` — 4 changes (dark mode + ARIA fixes)
  - `ManageCategories.tsx` — 4 changes (dark mode + ARIA fixes)
  - `StatusBadge.tsx` — 4 changes (dark mode + ARIA + contrast)
  - `index.css` — 4 changes (transitions + reduced motion + dark mode styles)
- New files created: ~12 (hook, test files, audit report, accessibility spec)
- Zero reverts, zero force-pushes

## Codebase Health

- LSP errors: 0
- LSP warnings: 0
- TODO/FIXME/HACK markers: 0 (entire project source)
- Net debt markers added: 0

## Code Review Finding Trend

| Story | Findings | Severity | Pattern |
|-------|----------|----------|---------|
| 8.1 Dark Mode | 5 | 2H, 3M | StatusBadge non-brand colors, CSS transition scope, markdown HSL values, system preference listener |
| 8.2 Skip/Titles/Motion | 6 | 1H, 2M, 3L | Blanket animation-duration froze spinners, not-found.tsx hardcoded colors, skip link absent on 404 |
| 8.3 E2E Tests | 10 | 4H, 4M, 2L | Dependencies vs devDependencies, missing script, waitForTimeout calls, incomplete AC flows |
| 8.4 WCAG Audit | 7 (CR) | 4H, 3M | SearchHero bg-white, DiffField dark mode, yellow/amber text, Settings tab bg-white |

**Trend:** 5→6→10→7 — Unlike Epic 7's decreasing trend (4→2→1→0→0), Epic 8 maintained consistent finding levels because each story touched different cross-cutting surface areas. This is expected for a quality/audit epic.

**Total findings: 28 (11H, 11M, 6L) — all HIGH and MEDIUM fixed in-session.**

## Lessons Learned

### Lesson 1: Hardcoded Brand Tokens Are Hidden Dark Mode Debt

`text-kat-black` (#1a1a1a) and `text-kat-charcoal` (#4f524c) were used in 28+ locations across 15 files for headings and body text. These were invisible on dark backgrounds, creating 28 Critical contrast violations. The systematic fix — replacing with semantic tokens (`text-foreground`, `text-muted-foreground`) — was mechanical once established but revealed that the design system debt had accumulated silently across Epics 1-7.

**Takeaway:** Use semantic tokens (`text-foreground`, `bg-background`, `bg-card`) from the start, never brand-specific tokens directly in components. If dark mode is planned, semantic tokens prevent the entire class of contrast violations.

### Lesson 2: Cross-Cutting Quality Epics Belong at the End

Epic 8's position as the final epic was validated. The WCAG audit found 48 issues across the complete application — this audit would have been incomplete if run earlier. The E2E test suite covers all 8 user journeys from Epics 1-7. Dark mode touched every page. These cross-cutting concerns require the full application to be built first.

**Takeaway:** Schedule quality/accessibility/testing epics last. They audit the complete work product and catch accumulated issues that individual story-level testing misses.

### Lesson 3: Adversarial Code Reviews Catch What Automation Misses

Every story had adversarial code review findings. The most impactful: Story 8.4's CR pass found 4 HIGH dark mode bugs (SearchHero bg-white, DiffField colors, Settings tab bg-white) that automated axe-core scanning didn't detect. The three-layer verification pattern (dev → code review → adversarial review) is the quality standard.

**Takeaway:** Automated accessibility scanning is necessary but not sufficient. Adversarial human-in-the-loop code review catches visual and contextual issues that automated tools miss.

### Lesson 4: Targeted Selectors Over Blanket Overrides

Story 8.1's initial CSS transition used a global `*` selector that interfered with Framer Motion. Story 8.2's initial `animation-duration: 0ms` on `body *` froze 25+ loading spinners. Both were caught in code review and fixed with targeted selectors. The pattern: scope CSS overrides to specific classes or element groups, never use `*` for behavior changes.

**Takeaway:** When adding CSS overrides for dark mode, reduced motion, or transitions, always use targeted selectors. Blanket `*` selectors create unpredictable side effects across component libraries.

### Lesson 5: Foundation-First Ordering Scales Across Epic Types

The foundation-first pattern (Epic 7: auth first; Epic 8: dark mode first) proved effective again. Story 8.1 created `use-theme.ts`, the FOWT prevention script, and the semantic token migration pattern. Stories 8.2, 8.3, and 8.4 all consumed these foundations without modification.

**Takeaway:** Foundation-first ordering is a universal pattern. Whether the epic is feature work (Epic 7) or quality work (Epic 8), identifying and implementing the cross-cutting foundation story first multiplies velocity for subsequent stories.

### Lesson 6: Zero Debt Markers Is a Project-Wide Achievement

Across all 8 epics and 26 stories, the final codebase has exactly 0 TODO/FIXME/HACK markers. All deferrals are documented in story records, audit reports, and retrospective action items. This is the standard the team set in Epic 7 and maintained through Epic 8.

**Takeaway:** Document deferrals in structured artifacts (story records, audit reports), not in code comments. This keeps the codebase clean and makes deferred work visible in project management, not hidden in grep results.

## Epic 7 Retrospective Follow-Through

| # | Action Item | Status | Evidence |
|---|------------|--------|----------|
| 1 | Resolve domain restriction (AC8/AC9) | ⚠️ Unresolved | Not addressed in any Epic 8 story — still a production blocker |
| 2 | Create `useDocumentTitle` hook | ❌ Consciously Declined | Story 8.2 dev notes explicitly chose inline useEffect pattern — pragmatic decision for S-sized story |
| 3 | Establish admin-flow E2E testing pattern | ✅ Done | Story 8.3 created Playwright suite with permissions tests and review flow tests |
| 4 | Update replit.md with Epic 7 architecture | ⏳ Partial | Not explicitly tracked in Epic 8 stories |
| 5 | Consolidate carry-forward tech debt | ⏳ Partial | Some items remain; however, Epic 8 audit addressed many underlying issues |

**Follow-through rate:** 1 fully completed, 1 consciously declined with reasoning, 2 partially addressed, 1 unresolved (HIGH priority).

### Epic 7 Team Agreements Applied

| Agreement | Applied? | Evidence |
|-----------|----------|----------|
| Sequential story stacking | ✅ Yes | 8.1→8.2→8.3→8.4 executed in order |
| Create shared utilities in foundation stories | ✅ Yes | use-theme.ts created in 8.1, consumed by later stories |
| Zero debt marker standard | ✅ Yes | 0 markers added, 0 in codebase |
| Foundation-first ordering | ✅ Yes | 8.1 dark mode laid foundation for 8.2, 8.3, 8.4 |
| Build systemic solutions for recurring findings | ⏳ Partial | useDocumentTitle hook declined; theme patterns built |

## Team Agreements

- Semantic tokens from day one — never use brand tokens (text-kat-black, bg-white) directly in components
- Zero debt marker standard — maintained across all 8 epics, 26 stories
- Foundation-first ordering — proven effective across Epics 5, 6, 7, and 8
- Adversarial code reviews are mandatory — three-layer verification (dev → review → adversarial) catches real bugs
- Targeted CSS selectors over blanket overrides — no `*` selectors for behavior changes
- Cross-cutting quality epics should be last in the project plan

## Readiness Assessment

| Area | Status | Notes |
|------|--------|-------|
| Testing & Quality | ✅ Strong | Playwright E2E + axe-core a11y tests, all passing |
| Code Quality (LSP) | ✅ Clean | 0 errors, 0 warnings |
| Tech Debt Trend | ✅ Net zero | 0 markers in entire source |
| Git Health | ✅ Healthy | 11% fix ratio, no reverts, steady cadence |
| Accessibility | ✅ WCAG AA Pass | 48 issues found and fixed |
| Dark Mode | ✅ Complete | System preference + manual toggle + localStorage persistence |
| Domain Restriction | ⚠️ Unresolved | AC8/AC9 from Epic 7 — production blocker |
| Viewport A11y Testing | ⚠️ Gap | AC7 — automated at 1280px only |
| Package.json | ⚠️ Minor | @playwright/test in wrong section, missing test:e2e script |
| Minor A11y Issues | ℹ️ 5 items | Documented in audit report |
| Carry-Forward Debt | ℹ️ 5 items | Unchanged from Epic 5/6, LOW priority |

## Action Items

| # | Action | Priority | Owner | When |
|---|--------|----------|-------|------|
| 1 | Resolve domain restriction (AC8/AC9) | HIGH | Charlie (Senior Dev) | Before launch |
| 2 | Move @playwright/test to devDependencies | MEDIUM | Charlie (Senior Dev) | Before launch |
| 3 | Add test:e2e npm script | MEDIUM | Charlie (Senior Dev) | Before launch |
| 4 | Add multi-viewport axe-core tests (AC7) | MEDIUM | Dana (QA Engineer) | Before launch |
| 5 | Verify Mobile Spotlight ARIA at 375px | MEDIUM | Dana (QA Engineer) | Before launch |
| 6 | Fix 5 minor accessibility audit issues | LOW | Dana (QA Engineer) | Post-launch cleanup |
| 7 | Consolidate carry-forward tech debt (5 items) | LOW | Team | Post-launch cleanup |
| 8 | Update replit.md with final project state | MEDIUM | Paige (Tech Writer) | Before launch |

## Outstanding Tech Debt

| # | Item | Severity | Source | When to Address |
|---|------|----------|--------|-----------------|
| 1 | `GET /api/principles` bypasses storage layer | MEDIUM | Epic 4 | Post-launch refactor |
| 2 | Extract `useSearch()` hook for DRY | LOW | Epic 1 | Post-launch cleanup |
| 3 | Replace `<a>` with `<Link>` in search CTAs | LOW | Epic 1 | Post-launch cleanup |
| 4 | `PrincipleWithCount` type assertion | LOW | Epic 4 | Post-launch cleanup |
| 5 | Toast TOAST_REMOVE_DELAY 1000000ms | LOW | Pre-existing | Post-launch cleanup |
| 6 | DesignSystem.tsx hardcoded colors | LOW | Epic 8 audit | Post-launch cleanup |
| 7 | StatusBadge light-mode token simplification | LOW | Epic 8 audit | Post-launch cleanup |
| 8 | Color picker buttons lack aria-labels | LOW | Epic 8 audit | Post-launch cleanup |
| 9 | Proposal status badge dark variants | LOW | Epic 8 audit | Post-launch cleanup |

## Project Completion Metrics

| Metric | Value |
|--------|-------|
| Total Epics | 8 |
| Total Stories | 26 (5L, 14M, 7S) |
| All 44 Functional Requirements | Covered |
| Architecture Decisions | 15 (AD-1 through AD-15) |
| WCAG 2.1 AA | Compliant (48 issues fixed) |
| Auth System | Replit Auth (OIDC + Google sign-in) |
| E2E Test Coverage | 8 user journeys, 3 viewports |
| LSP Errors | 0 |
| Tech Debt Markers | 0 |
| Retrospectives Completed | 7 (Epics 1, 2, 4, 5, 6, 7, 8 — Epic 3 optional) |

## Epic 8 Metrics Summary

| Metric | Value |
|--------|-------|
| Stories completed | 4 |
| Code review findings | 28 total (11H, 11M, 6L — all H/M fixed) |
| Accessibility issues fixed | 48 (28 Critical + 15 Major + 5 CR) |
| Files created | ~12 |
| Files modified | ~18 |
| LSP errors/warnings | 0 / 0 |
| Tech debt markers added | 0 |
| Fix-to-feature commit ratio | 11% |
| Carry-forward tech debt | 9 items (5 from Epics 5/6 + 4 new LOW from audit) |
| Retro action item follow-through (Epic 7) | 1/5 completed, 1 consciously declined, 2 partial, 1 unresolved |
