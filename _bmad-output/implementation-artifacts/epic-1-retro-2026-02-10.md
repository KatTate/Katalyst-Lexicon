# Epic 1: Search & Discovery — Retrospective

Date: 2026-02-10
Facilitator: Bob (Scrum Master)
Epic: 1 — Search & Discovery
Status: Complete (all 4 stories done, all 41 ACs met)

## Epic Summary

Epic 1 delivered the search-first experience that is the primary entry point for the Katalyst Lexicon. Four stories were completed: ranked search with results-as-you-type (1.1), keyboard navigation (1.2), mobile Spotlight overlay (1.3), and recently updated terms on the home page (1.4).

## Story Completion Profile

| Story | Size | ACs | Files Created | Files Modified | Notes |
|-------|------|-----|---------------|----------------|-------|
| 1.1 Search API + SearchHero | L | 18 | 2 (SearchHero, useDebounce) | 5 | Foundation story — delivered 1.4 scope as well |
| 1.2 Keyboard Navigation | S | 11 | 0 | 2 | Fixed Party Mode findings from 1.1 |
| 1.3 Mobile Spotlight | M | 9 | 2 (SpotlightSearch, SpotlightContext) | 2 | SpotlightContext pattern for cross-component state |
| 1.4 Recently Updated | S | 3 | 0 | 0 | Zero code changes — already built in 1.1 |

## Git Commit Analysis

- Total implementation commits: ~12
- Fix/correction commits: 1 (Tab key handler — caught in code review)
- Fix-to-feature ratio: ~8% (healthy)
- Most-touched file: SearchHero.tsx (3 changes — iterative enhancement, not churn)
- Total code changes: 10 files, +769/-138 lines (net +631)
- New files: SearchHero.tsx, SpotlightSearch.tsx, SpotlightContext.tsx, useDebounce.ts

## Codebase Health

- LSP errors: 0
- LSP warnings: 0
- TODO/FIXME/HACK markers: 0
- Net debt markers added: 0

## Code Review Findings

| # | Finding | Severity | Status |
|---|---------|----------|--------|
| 1 | SpotlightSearch Tab key was a no-op in Sheet focus trap | HIGH | Fixed |
| 2 | StatusBadge colors differ from AC literal text | LOW | Design interpretation |
| 3 | Search logic duplication (~80 lines) between SearchHero and SpotlightSearch | MEDIUM | Debt — fix before Epic 5 |
| 4 | useIsMobile initial render flash | LOW | Acceptable (<100ms) |
| 5 | Empty state CTA uses `<a>` instead of wouter `<Link>` | LOW | Fix before Epic 5 |
| 6 | highlightMatch doesn't escape regex special chars | LOW | No current risk |
| 7 | searchTerms SQL parameterization | PASS | Properly secured |

Overall Code Quality: A (A on quality/security/performance, B+ error handling, B DRY)

## Lessons Learned

### Lesson 1: Story Overlap — 1.1 Pre-Built 1.4
Story 1.4 (Recently Updated) required zero code changes because Story 1.1's home page redesign naturally included the recently-updated section. This created overhead (story creation, validation, E2E testing) for zero implementation work.

**Takeaway:** When a smaller story shares a page with a larger one and the larger story naturally delivers the smaller story's ACs, consider merging them during sprint planning.

### Lesson 2: TermCard Variant Pattern
Story 1.2 introduced `variant="inline"` vs `variant="card"` to handle card-in-card nesting in the search dropdown. This cleanly separates rendering contexts without component duplication.

**Takeaway:** Apply this variant pattern to future components (PrincipleCard, ProposalCard) that appear in both list and embedded contexts.

### Lesson 3: Search Logic Duplication
SearchHero and SpotlightSearch independently implement query state, debounce, TanStack Query, keyboard navigation, highlighting, and result rendering. ~80 lines of duplicated logic.

**Takeaway:** Extract a `useSearch()` custom hook. Not blocking for Epics 2-4, but required before Epic 5 (proposal form duplicate detection).

### Lesson 4: Code Review Value
The only real bug (Tab key handler no-op) was caught during code review, not in testing. Inside a Radix Sheet focus trap, Tab appeared to work but actually cycled focus within the overlay.

**Takeaway:** Code reviews are high-value. Continue per-epic reviews at minimum.

### Lesson 5: Party Mode Finding Carry-Forward
Findings from Story 1.1 Party Mode review (aria-controls on unmounted listbox, card-in-card nesting) were carried forward to Story 1.2 and resolved. This prevented accumulated issues.

**Takeaway:** Continue carrying forward unresolved findings between stories.

## Readiness Assessment for Next Epics

### Epic 2: Term Detail Experience (2 stories: 1L, 1M)
- No dependencies on Epic 1
- Reuses: StatusBadge, TermCard, formatRelativeTime
- New: TierSection, UsageGuidance, breadcrumbs, markdown rendering
- No blockers from Epic 1 findings

### Epic 3: Browse & Discover (2 stories: 1L, 1M)
- No dependencies on Epic 1
- Reuses: TermCard (variant="card"), StatusBadge, formatRelativeTime
- New: Category sidebar, filter controls, URL-driven state
- No blockers from Epic 1 findings

### Epic 4: Principles & Knowledge Connections (3 stories: 2M, 1S)
- No dependencies on Epic 1
- Reuses: TermCard (for linked terms), StatusBadge
- New: PrincipleCard, markdown rendering, principleTermLinks join
- Story 4.3 depends on Epic 2 Story 2.1 (term detail Tier 2 shell)

## Action Items

| # | Action | Priority | When |
|---|--------|----------|------|
| 1 | Extract `useSearch()` hook from SearchHero/SpotlightSearch | Medium | Before Epic 5 |
| 2 | Replace `<a>` with `<Link>` in empty state CTAs | Low | Before Epic 5 |
| 3 | Apply TermCard variant pattern to new card components | Medium | During Epic 4 |
| 4 | Verify Story 4.3 dependency on Epic 2 Story 2.1 | Medium | During Epic 4 planning |
| 5 | Consider merging overlapping stories during sprint planning | Low | Ongoing |
