# Epic 2: Term Detail Experience — Retrospective

Date: 2026-02-11
Facilitator: Bob (Scrum Master)
Epic: 2 — Term Detail Experience
Status: Complete (all 2 stories done, all 16 ACs met)

## Epic Summary

Epic 2 delivered the "answer moment" for Katalyst Lexicon — the term detail page where users land after searching or browsing. Two stories refined the existing TermDetail.tsx implementation: Story 2.1 applied the two-tier progressive disclosure layout with breadcrumbs, deprecated banner, and suggest-edit navigation, while Story 2.2 enhanced version history with "v1 — Original" labels, "Current" badge, and ARIA screen reader support. The epic was notable for being net-negative in code — more code was removed than added, simplifying the page significantly.

## Story Completion Profile

| Story | Size | ACs | Files Created | Files Modified | Notes |
|-------|------|-----|---------------|----------------|-------|
| 2.1 Term Detail Two-Tier | L | 11 | 0 | 2 (TermDetail.tsx, ProposeTerm.tsx) | Replaced inline edit dialog with navigation to /propose?editTermId. Fixed deprecated banner amber colors. |
| 2.2 Version History | M | 5 | 0 | 1 (TermDetail.tsx) | Added "v1 — Original" label, "Current" badge, ARIA list roles. Snapshot dialog already existed. |

## Git Commit Analysis

- Total implementation commits: 4
- Fix/correction commits: 1 ("Update term detail and proposal pages with new features and fixes")
- Fix-to-feature ratio: 25% (1 of 4 commits — inflated by small commit count; in absolute terms, one iteration cycle)
- Most-touched file: TermDetail.tsx (365 lines changed — major simplification)
- Total code changes: 4 files, +146/-318 lines (**net -172 lines**)
- New files created: 0
- File churn: Zero — each file touched exactly once during Epic 2

**Files Changed:**

| File | Changes | Nature |
|------|---------|--------|
| TermDetail.tsx | 365 lines | Major cleanup — removed inline edit dialog, simplified deprecated banner, added version history labels |
| ProposeTerm.tsx | 97 lines | Added editTermId pre-fill support, edit mode UI |
| TierSection.tsx | 2 lines | Minor (h2 heading inside button for accessibility) |
| opengraph.jpg | binary | Asset optimization |

**Commit Patterns:**
- Steady, clean implementation — no reverts, no hacks, no workarounds
- Commit messages are descriptive and accurate
- No burst commits or late-stage large changes
- No cross-story file conflicts (both stories modified TermDetail.tsx but sequentially, not concurrently)

## Codebase Health

- LSP errors: 0
- LSP warnings: 0
- TODO/FIXME/HACK markers: 0
- Net debt markers added: 0

## Code Review Findings

*Note: This code review was performed during the retrospective after the user identified the missing review as an oversight.*

| # | Finding | Severity | Status |
|---|---------|----------|--------|
| 1 | `snapshotJson` uses `as any` type casting 10 times in version snapshot dialog | LOW | Carry forward — define SnapshotJson type interface |
| 2 | Deprecated banner uses unsafe type assertion `(term as Term & { replacementTermId?: string })` for fields not in schema | LOW | Known limitation — documented in sprint plan. No `replacedByTermId` in schema. |
| 3 | TierSection heading pattern: `<button>...<h2>Title</h2>...</button>` — h2 is child of button. Sprint plan Finding #8 recommended `<h2><button aria-expanded>Title</button></h2>` per WAI-ARIA accordion spec | LOW | Functionally equivalent — button has aria-expanded, h2 provides semantic heading. Current pattern is valid HTML and accessible. |
| 4 | ProposeTerm page title not set via `document.title` useEffect | LOW | Not an AC for Epic 2 — queue for Epic 5 when proposal form is fully built |
| 5 | Version history empty state says "No version history available" — should always show at least v1 for any existing term | LOW | Edge case — only occurs if versions API returns empty. Defensive UI is appropriate. |
| 6 | `Share2` and `Edit` icons always imported even though only used in specific UI states | LOW | No action — tree-shaking handles unused exports; icons are small and always rendered in the current layout |
| 7 | Story file frontmatter still showed `status: review` instead of `done` | MEDIUM → RESOLVED | Fixed during retrospective |

Overall Code Quality: A- (A on security/performance/architecture, A on accessibility, B+ on type safety due to `as any` casts)

## Lessons Learned

### Lesson 1: Net-Negative Code is a Win

Epic 2 removed 172 more lines than it added. The inline edit dialog (with form, state management, and mutation logic) was replaced by a simple `<Link>` navigation to ProposeTerm. This reduced complexity, eliminated duplicated form logic, and improved UX (the full proposal form is better than a cramped dialog).

**Takeaway:** When refactoring brownfield code, removing code is often more valuable than adding it. The simplest solution (navigation link vs inline dialog) was also the best UX.

### Lesson 2: Brownfield Stories Can Be Very Efficient

Both stories were completed with zero new files and minimal code changes. Most ACs were already substantially met by existing code from earlier epics. The sprint plan's gap analysis correctly identified the small scope remaining.

**Takeaway:** Accurate gap analysis before sprint planning reduces waste. When existing code covers 70%+ of ACs, the remaining work is surgical and fast.

### Lesson 3: Sprint Plan File-Batching Strategy Validated

The sprint plan batched Stories 4.3, 2.1, and 2.2 together because all three modified TermDetail.tsx. This strategy worked perfectly — zero file churn, no merge conflicts, sequential modifications to the same file with cumulative improvements.

**Takeaway:** When multiple stories touch the same file, executing them in sequence within the same sprint prevents churn and conflict. Continue this strategy for future sprints.

### Lesson 4: Code Review Process Gap

Epic 2's code review was skipped — an oversight caught during the retrospective. Previous epics (1 and 4) both had formal code reviews that caught real bugs (Tab key handler in Epic 1, archived banner copy in Epic 4). While Epic 2's review found only LOW severity items, the process gap is worth addressing.

**Takeaway:** Formalize code review as a sprint gate — no story should move to "done" in sprint-status without a code review artifact. Add this to the Definition of Done.

### Lesson 5: Type Safety Debt Accumulating in Snapshot/Deprecated Patterns

The `as any` pattern for `snapshotJson` (10 occurrences) and the type assertion for deprecated replacement term fields are minor individually but represent a pattern of bypassing TypeScript safety. Both are driven by schema limitations — `snapshotJson` is stored as JSON and the schema lacks `replacedByTermId`.

**Takeaway:** Define a `SnapshotJson` TypeScript interface matching the expected snapshot shape. This eliminates 10 `as any` casts with a single type definition. Queue for cleanup sprint.

## Epic 4 Retrospective Follow-Through

| # | Action Item | Status | Evidence |
|---|------------|--------|----------|
| 1 | Mark Epic 4 as "done" in sprint-status.yaml | ✅ Done | sprint-status.yaml shows epic-4: done |
| 2 | Add `getPrinciplesWithCounts()` to storage layer | ⏳ Not yet needed | No storage refactoring during Epic 2 |
| 3 | Update API client types to include `linkedTermCount` | ⏳ Not yet needed | No API client updates during Epic 2 |
| 4 | Extract `useSearch()` hook (Epic 1 carry-forward) | ⏳ Deferred | Before Epic 5 |
| 5 | Replace `<a>` with `<Link>` in empty state CTAs (Epic 1 carry-forward) | ⏳ Deferred | Before Epic 5 |
| 6 | Clean up identity CSS/component overrides | ⏳ Not yet needed | Cleanup sprint |

**Epic 4 Team Agreements — Follow-Through:**
- "Continue foundation story pattern" → N/A (Epic 2 had only 2 stories, no shared foundation needed)
- "Apply exact AC copy verification in brownfield stories" → **Applied.** Story 2.1 explicitly changed deprecated banner from red/destructive to amber per AC text.
- "Continue carrying forward open findings" → **Applied.** Story file frontmatter status was carried forward and resolved during retrospective.

**Follow-through rate:** 1 of 6 completed, 5 appropriately deferred to their scheduled timelines. All team agreements actively applied.

## Retrospective Discussion Summary

**Participants:** Bob (Scrum Master), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), User (Project Lead)

**Key Discussion Points:**

1. **Code Review Oversight** — User confirmed the missing code review was an oversight, not intentional. Team agreed to add "code review artifact exists" to Definition of Done going forward.

2. **Net Code Reduction** — Team celebrated the -172 line delta. Charlie noted this is rare in brownfield work and indicates the codebase is getting healthier over time.

3. **Epic 3 Preparation** — Team previewed Epic 3 (Browse & Discover). Key risks: IntersectionObserver scroll sync complexity (flagged in sprint plan as non-trivial), URL-driven filter state (new architectural pattern). Pre-sprint decision needed: filter UI pattern (toggle pills vs dropdown).

**Team Agreements:**
- Add "code review artifact must exist" to Definition of Done — no story moves to done in sprint-status without a review file
- Update story file frontmatter to done when sprint-status is updated (keep in sync)
- Define `SnapshotJson` TypeScript interface before next story that touches version history

**No Significant Discovery Alert:** Nothing from Epic 2 fundamentally changes the plan for Epic 3 or subsequent epics. The plan remains sound.

## Readiness Assessment for Epic 3

### Epic 3: Browse & Discover (2 stories: 1L, 1M)
- **Status:** ready-for-dev
- **Story 3.1:** Browse Page with Category Sections and Sidebar [Size: L] — Major restructure
- **Story 3.2:** Filter Terms by Status and Visibility [Size: M] — New filter system
- **Reuses:** TermCard, StatusBadge, EmptyState, formatRelativeTime — all stable
- **New patterns:** IntersectionObserver scroll tracking, URL param sync, client-side filtering
- **Risk:** Medium — Story 3.1 is the largest restructure since the project began
- **Pre-sprint decision required:** Filter UI pattern for Story 3.2 (toggle pills vs dropdown for desktop/mobile)
- **No blockers from Epic 2**

### Carry-Forward Items for Pre-Epic 5
- Extract `useSearch()` hook (Epic 1 action #1)
- Replace `<a>` with `<Link>` in empty state CTAs (Epic 1 action #2)
- Define `SnapshotJson` TypeScript interface (Epic 2 code review finding #1)

## Outstanding Tech Debt from Epic 2

| # | Item | Severity | Source | When to Address |
|---|------|----------|--------|-----------------|
| 1 | `snapshotJson` uses `as any` 10 times | LOW | Code review finding #1 | Define SnapshotJson interface — cleanup sprint or next version history touch |
| 2 | Deprecated replacement term type assertion | LOW | Code review finding #2 | When `replacedByTermId` is added to schema (future story) |
| 3 | TierSection heading-inside-button pattern | LOW | Code review finding #3 | No action needed — functionally accessible |
| 4 | ProposeTerm missing document.title | LOW | Code review finding #4 | Epic 5 when proposal form is fully built |

## Action Items

| # | Action | Priority | When |
|---|--------|----------|------|
| 1 | Add "code review artifact exists" to Definition of Done | High | Immediately — before Epic 3 |
| 2 | Keep story file frontmatter and sprint-status in sync | Medium | Ongoing process |
| 3 | Define `SnapshotJson` TypeScript interface | Low | Next version history touch or cleanup sprint |
| 4 | Extract `useSearch()` hook (Epic 1 carry-forward) | Medium | Before Epic 5 |
| 5 | Replace `<a>` with `<Link>` in empty state CTAs (Epic 1 carry-forward) | Low | Before Epic 5 |
| 6 | Decide filter UI pattern for Epic 3 Story 3.2 | Medium | Before Epic 3 Sprint 2 starts |

## Epic 2 Metrics Summary

| Metric | Value |
|--------|-------|
| Stories completed | 2 (1L, 1M) |
| Total ACs | 16 (all satisfied) |
| New components created | 0 |
| Files modified | 3 (TermDetail.tsx, ProposeTerm.tsx, TierSection.tsx) |
| Net lines changed | -172 (146 additions, 318 deletions) |
| Code review findings | 7 total (0 HIGH, 1 MEDIUM resolved, 6 LOW) |
| Bugs caught in review | 0 (process gap — story frontmatter sync, not a code bug) |
| Tech debt items | 4 (all LOW, none blocking) |
| Packages added | 0 |
| Security issues | 0 |
