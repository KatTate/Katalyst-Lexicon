# Epic 5: Propose & Contribute — Retrospective

Date: 2026-02-11
Facilitator: Bob (Scrum Master)
Epic: 5 — Propose & Contribute
Status: Complete (2 stories done, all 34 ACs met)

## Epic Summary

Epic 5 delivered the contribution experience for Katalyst Lexicon — transforming team members from passive readers into active contributors. Two stories were implemented: Story 5.1 refactored the proposal form with progressive disclosure, conversational labels, inline validation, duplicate detection, and unsaved changes protection. Story 5.2 enhanced edit mode with an unlocked name field, required change notes, change detection guards, duplicate detection suppression, and auto-expanding optional sections. Both stories modified a single file (`ProposeTerm.tsx`), making this a focused, surgical epic.

## Story Completion Profile

| Story | Size | ACs | Files Created | Files Modified | Notes |
|-------|------|-----|---------------|----------------|-------|
| 5.1 Proposal Form for New Terms | L | 18 | 0 | 1 (ProposeTerm.tsx) | Major refactor: progressive disclosure, conversational labels, validation, duplicate detection, unsaved changes guard |
| 5.2 Propose Edits to Existing Terms | M | 16 | 0 | 1 (ProposeTerm.tsx) | Edit mode enhancements: unlock name, change notes, change detection, auto-expand, duplicate suppression |

## Git Commit Analysis

- Total implementation commits: 3 (including checkpoints)
- Fix/correction commits: 0 (no bugs caught during or after implementation)
- Fix-to-feature ratio: 0% (excellent — cleanest epic yet)
- Most-touched file: ProposeTerm.tsx (single file, 2 sequential rewrites)
- Total code changes: 1 implementation file, +492/-352 lines (net +140)
- New files created: 0
- File churn: ProposeTerm.tsx rewritten twice (5.1 then 5.2) — sequential, not conflicting

**Files Changed:**

| File | Changes | Nature |
|------|---------|--------|
| ProposeTerm.tsx | 844 lines diff | Major refactor — progressive disclosure, validation, edit enhancements |
| opengraph.jpg | binary | Incidental asset update |
| replit.md | 159 lines | Documentation update (process, not implementation) |

**Commit Patterns:**
- Clean sequential implementation: 5.1 first, 5.2 layered on top
- Zero reverts, zero hacks, zero workarounds
- No cross-story file conflicts (both stories modify the same file sequentially)
- Story 5.2 was implemented as an incremental enhancement of 5.1, not a rewrite

## Codebase Health

- LSP errors: 0
- LSP warnings: 0
- TODO/FIXME/HACK markers: 0
- Net debt markers added: 0

## Code Review Findings

| # | Finding | Severity | Status |
|---|---------|----------|--------|
| 1 | Edit mode submit button not disabled until valid (form-level validation instead) | LOW | Accepted — valid UX pattern |
| 2 | Duplicate detection uses client-side name comparison instead of tier filtering | LOW | Accepted — equivalent result, documented |
| 3 | `useSearch()` hook extraction not done (Epic 1 carry-forward) | LOW | Scoped as DRY improvement, not dependency |
| 4 | `formDirtyRef` slightly overprotective in edit mode (change note counts as dirty) | LOW | Accepted — protective > permissive |
| 5 | Toast TOAST_REMOVE_DELAY 1000000ms globally (pre-existing) | LOW | Pre-existing, no change |
| 6 | `<a>` vs `<Link>` in search CTAs still open (Epic 1 carry-forward) | LOW | Carry forward |
| 7 | ProposeTerm missing `document.title` (Epic 2 carry-forward) | LOW | Carry forward |

Overall Code Quality: A (A across quality/architecture/security/performance/DRY, A- accessibility)

## Lessons Learned

### Lesson 1: Sequential Story Stacking Works for Single-File Epics

Both stories modified only ProposeTerm.tsx. Story 5.1 was a major refactor (progressive disclosure, validation, duplicate detection, unsaved changes). Story 5.2 was an incremental enhancement on top (edit mode improvements). This sequential stacking pattern worked cleanly because:
- 5.1 established the architectural patterns (Collapsible, form state, AlertDialog, callbacks)
- 5.2 reused those patterns and added conditional logic (`isEditMode` branching)
- No conflicts or rework between stories

**Takeaway:** When an epic modifies a single file, sequential story stacking is efficient. The first story does the heavy lifting; subsequent stories layer behavior. Budget the first story as Large even if the second is Medium — the foundational patterns are the investment.

### Lesson 2: Duplicate Detection Was Simpler Than Anticipated

The Epic 1 retrospective recommended extracting a `useSearch()` hook before Epic 5 for duplicate detection. In practice, the proposal form's duplicate check is much simpler than the search UI — it needs a single blur-triggered API call and a client-side name filter, not debounce, highlighted index, keyboard navigation, or result rendering. Calling `api.terms.search()` directly was the right choice.

**Takeaway:** Don't over-engineer shared abstractions. The `useSearch()` hook is valuable for deduplicating SearchHero and SpotlightSearch (which share ~80 lines of identical logic), but it's NOT needed for duplicate detection. Evaluate carry-forward recommendations against actual use cases — sometimes the simpler approach is correct.

### Lesson 3: Change Detection Requires Dual-Track Comparison

React Hook Form's `isDirty` only tracks fields registered with the form. The proposal form has three array fields (examplesGood, examplesBad, synonyms) managed via `useState` outside the form. Change detection required combining `formState.isDirty` with `JSON.stringify` comparison of arrays against the original term data.

**Takeaway:** When forms mix react-hook-form fields with external state, plan for hybrid change detection. The dual-track pattern (`isDirty` + manual comparison) is reusable for future forms with dynamic lists.

### Lesson 4: Unsaved Changes Guard Has Two Surfaces

Browser navigation (close tab, refresh, type URL) is handled by `window.addEventListener("beforeunload")`. App-internal navigation (clicking sidebar links, back buttons) requires a separate guard — in this case, intercepting click handlers with `navigateWithGuard()` and showing an AlertDialog. These two surfaces are easy to miss.

**Takeaway:** Always implement both `beforeunload` (browser) and navigation interception (app) for unsaved changes. The `formDirtyRef` pattern (ref instead of state to avoid stale closures in event listeners) is the correct approach for the beforeunload handler.

### Lesson 5: Progressive Disclosure Keeps Contribution Barrier Low

The Collapsible pattern for optional fields (usage guidance, examples, synonyms) means new contributors see only 4 required fields on page load. This is significantly less intimidating than the previous 10+ field form. In edit mode, auto-expanding the Collapsible when optional fields have content ensures editors see everything without extra clicks.

**Takeaway:** Progressive disclosure is a proven pattern for contribution forms. The "show less by default, more on demand" approach respects both new contributors (low barrier) and editors (full context). The auto-expand-on-edit variant is essential to avoid hiding pre-existing content.

### Lesson 6: Zero Bugs Is Possible with Strong Constraints

Epic 5 had zero bugs caught during review or testing. This is attributed to:
- Strong Dev Notes constraints (no schema changes, no server changes, single file)
- Well-defined ACs (34 total with specific behavior descriptions)
- Sequential implementation (5.1 patterns validated before 5.2 built on them)
- E2E testing after each story confirmed behavior

**Takeaway:** Tight scope (single file, no server changes) combined with detailed ACs produces clean implementations. The constraints eliminated entire categories of bugs (API mismatches, schema drift, cross-file coordination).

## Prior Epic Retrospective Follow-Through

### Epic 1 Action Items

| # | Action Item | Status | Evidence |
|---|------------|--------|----------|
| 1 | Extract `useSearch()` hook from SearchHero/SpotlightSearch | ⚡ Superseded | "Before Epic 5" timeline closed — Epic 5 duplicate detection doesn't use search UI logic. Reclassified as cleanup sprint DRY improvement for SearchHero/SpotlightSearch only. |
| 2 | Replace `<a>` with `<Link>` in empty state CTAs | ⏳ Deferred | Not addressed. Epic 5 introduces no new `<a>` tags. Carry forward to cleanup sprint. |
| 3 | Apply TermCard variant pattern to new card components | ✅ Done (Epic 4) | Completed during Epic 4 (PrincipleCard). |
| 4 | Verify Story 4.3 dependency on Epic 2 Story 2.1 | ✅ Done (Epic 4) | Verified and resolved. |
| 5 | Consider merging overlapping stories during sprint planning | ⏳ Ongoing | Epic 5's two stories were well-scoped — no merge needed. |

### Epic 2 Action Items

| # | Action Item | Status | Evidence |
|---|------------|--------|----------|
| 1 | Add "code review artifact exists" to Definition of Done | ✅ Applied | Code review artifact created for Epic 5. |
| 2 | Keep story file frontmatter and sprint-status in sync | ⏳ Ongoing | Process followed. |
| 3 | Define `SnapshotJson` TypeScript interface | ⏳ Deferred | No version history touch in Epic 5. |
| 4 | Extract `useSearch()` hook (carry-forward) | ⚡ Superseded | See Epic 1 #1 above — "before Epic 5" timeline closed. |
| 5 | Replace `<a>` with `<Link>` (carry-forward) | ⏳ Deferred | See Epic 1 #2 above. |

### Epic 4 Action Items

| # | Action Item | Status | Evidence |
|---|------------|--------|----------|
| 1 | Mark Epic 4 as "done" | ✅ Done | Completed in prior sprint. |
| 2 | Add `getPrinciplesWithCounts()` to storage layer | ⏳ Deferred | No storage refactoring in Epic 5. |
| 3 | Update API client types for `linkedTermCount` | ⏳ Deferred | No API client updates in Epic 5. |
| 4 | Extract `useSearch()` hook (carry-forward) | ⚡ Superseded | See Epic 1 #1 above — "before Epic 5" timeline closed. |
| 5 | Replace `<a>` with `<Link>` (carry-forward) | ⏳ Deferred | See Epic 1 #2 above. |
| 6 | Clean up identity CSS/component overrides | ⏳ Deferred | Cleanup sprint. |

**Overall follow-through rate:** 5 completed across all epics, 2 superseded (useSearch "before Epic 5" timeline), 2 ongoing, remainder appropriately deferred.

### Epic 4 Team Agreements — Follow-Through

- "Continue foundation story pattern" → N/A (Epic 5 had only 2 stories modifying one file)
- "Apply exact AC copy verification in brownfield stories" → **Applied.** All 34 ACs verified against implementation during code review.
- "Continue carrying forward open findings" → **Applied.** 4 carry-forward findings tracked from Epics 1, 2, and 4.

### Epic 2 Team Agreement — Follow-Through

- "Code review artifact must exist before marking done" → **Applied.** Code review artifact created before retrospective.

## Retrospective Discussion Summary

**Participants:** Bob (Scrum Master), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), User (Project Lead)

**Key Discussion Points:**

1. **Zero-Bug Implementation** — Team noted this is the first epic with zero bugs caught during review or testing. Charlie attributed this to tight scope constraints (single file, no server changes) and strong AC specificity.

2. **Carry-Forward Debt** — Two items have been deferred across 4 epics now: `useSearch()` hook extraction and `<a>` to `<Link>` replacement. Neither has been needed yet, but the debt is accumulating. Team agreed to assess whether these are still relevant or should be closed as "won't do."

3. **Epic 6 Preparation** — Epic 6 (Review & Approve) depends on Epic 5's proposals. The review queue UI will need to display proposals created through the new form. Key risk: the approve-proposal flow is the most complex feature in the product (creates/updates term + version history entry + updates proposal status atomically).

**Team Agreements:**
- Assess carry-forward debt items from Epics 1-2 — close as "won't do" if no longer relevant, or schedule definitively
- Add `document.title` to ProposeTerm during next touch (lightweight enough to piggyback)
- Continue single-file epic pattern when scope permits — it reduces coordination overhead

**No Significant Discovery Alert:** Nothing from Epic 5 fundamentally changes the plan for Epic 6 or subsequent epics. The proposal creation flow works correctly, providing the foundation for the review workflow.

## Readiness Assessment for Next Epics

### Epic 6: Review & Approve (depends on Epic 5)
- **Status:** ready-for-dev
- **Dependency:** Epic 5 proposals are now creatable and stored. Review queue can display them.
- **Key risk:** Approve-proposal flow requires atomic database transaction (create/update term + version history + proposal status). Most complex feature in the product.
- **Reuses:** StatusBadge, TermCard, EmptyState, toast patterns, form validation patterns
- **New:** ReviewQueue page, ProposalDetail page, approval/rejection mutations, transaction logic
- **Risk:** HIGH — atomic multi-table transaction is new territory for this codebase

### Epic 7: Administration & Governance
- **Status:** backlog (can be done in parallel with Epic 6)
- **No dependencies on Epic 5**
- **New:** User management, category CRUD, principles authoring, settings page
- **Risk:** Medium — RBAC is new

### Epic 8: Quality & Testing
- **Status:** backlog (should be last)
- **Depends on:** All previous epics
- **Scope:** Dark mode, skip link, page titles, Playwright e2e suite, WCAG audit

## Outstanding Tech Debt from Epic 5

| # | Item | Severity | Source | When to Address |
|---|------|----------|--------|-----------------|
| 1 | ProposeTerm missing `document.title` | LOW | Epic 2 Finding 4, Epic 5 Finding 7 | Next ProposeTerm touch |
| 2 | Edit mode submit not disabled until valid | LOW | Epic 5 Finding 1 | Cleanup sprint |
| 3 | `useSearch()` hook extraction (SearchHero/SpotlightSearch DRY) | LOW | Epic 1 Finding 3 — "before Epic 5" superseded | Cleanup sprint (DRY only, not dependency) |
| 4 | `<a>` to `<Link>` in search empty state CTAs | LOW | Epic 1 Finding 5 | Cleanup sprint — re-evaluate relevance |
| 5 | Toast TOAST_REMOVE_DELAY 1000000ms | LOW | Epic 5 Finding 5 | Cleanup sprint |

## Action Items

| # | Action | Priority | When |
|---|--------|----------|------|
| 1 | Assess remaining carry-forward items: `<a>` to `<Link>`, SnapshotJson type, getPrinciplesWithCounts — close as "won't do" or schedule for cleanup sprint | Medium | Before Epic 6 planning |
| 2 | Add `document.title` to ProposeTerm | Low | Next ProposeTerm touch or cleanup sprint |
| 3 | Update story file frontmatter to "done" for 5.1 and 5.2 | High | ✅ Done (updated during retrospective) |
| 4 | Begin Epic 6 planning — decompose approve-proposal transaction | High | Next planning session |
| 5 | Reduce Toast TOAST_REMOVE_DELAY to reasonable value (e.g. 5000ms) | Low | Cleanup sprint |

## Epic 5 Metrics Summary

| Metric | Value |
|--------|-------|
| Stories completed | 2 (1L, 1M) |
| Total ACs | 34 (all satisfied) |
| New components created | 0 |
| Files modified | 1 (ProposeTerm.tsx) |
| Net lines changed | +140 (492 additions, 352 deletions) |
| Code review findings | 7 total (0 HIGH, 0 MEDIUM, 7 LOW — 3 new, 4 carry-forward) |
| Bugs caught in review | 0 (first zero-bug epic) |
| Security issues | 0 |
| Packages added | 0 |
| Tech debt items | 5 (all LOW, none blocking) |
